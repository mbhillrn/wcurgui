<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBCore Dashboard - Peer info, map, and tools for Bitcoin Core</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <h1 class="logo-text">MBCore Dashboard <span class="version">v2.3.8</span></h1>
                <span class="subtitle">Peer info, map, and tools for Bitcoin Core</span>
                <span class="credits">Created by mbhillrn | Support (btc): bc1qy63057zemrskq0n02avq9egce4cpuuenm5ztf5</span>
            </div>
            <div class="header-info">
                <span class="status-indicator" id="status-indicator"></span>
                <span id="connection-status">Connecting...</span>
                <div class="protocol-status" id="protocol-status">
                    <div class="protocol-line">
                        <span class="protocol-label">Enabled:</span>
                        <span class="protocol-list" id="protocols-enabled">-</span>
                    </div>
                    <div class="protocol-line">
                        <span class="protocol-label">Not Configured:</span>
                        <span class="protocol-list" id="protocols-disabled">-</span>
                    </div>
                    <div class="protocol-hint" id="protocol-hint" style="display: none;">
                        <span>(Configure in Bitcoin Core to view)</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Node Status Panel - Unified -->
        <div class="panel node-status-panel" id="node-status-panel">
            <div class="panel-header">
                <h2>Node Status</h2>
                <div class="panel-header-right">
                    <span class="status-time">
                        <span class="time-item">Next: <span id="stat-countdown">10s</span></span>
                        <span class="time-sep">|</span>
                        <span class="time-item" id="stat-localtime">--:--:--</span>
                    </span>
                    <button class="panel-config-btn" id="node-config-btn" title="Configure panel">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                        </svg>
                    </button>
                    <!-- Settings Dropdown -->
                    <div class="node-config-dropdown" id="node-config-dropdown">
                        <div class="dropdown-section">
                            <span class="dropdown-section-title">Update Frequency</span>
                            <div class="dropdown-row">
                                <input type="text" id="refresh-rate-input" value="10" class="refresh-input" title="Update frequency in seconds">
                                <span class="dropdown-unit">seconds</span>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-section">
                            <span class="dropdown-section-title">BTC Currency</span>
                            <select id="info-currency-select" class="info-currency-select">
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                                <option value="JPY">JPY</option>
                                <option value="CHF">CHF</option>
                                <option value="CAD">CAD</option>
                                <option value="AUD">AUD</option>
                                <option value="CNY">CNY</option>
                                <option value="HKD">HKD</option>
                                <option value="SGD">SGD</option>
                            </select>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-section">
                            <span class="dropdown-section-title">Show/Hide Cards</span>
                            <label class="dropdown-checkbox">
                                <input type="checkbox" id="info-show-networks" checked> Network Stats
                            </label>
                            <label class="dropdown-checkbox">
                                <input type="checkbox" id="info-show-chain" checked> Node Info
                            </label>
                            <label class="dropdown-checkbox">
                                <input type="checkbox" id="info-show-system" checked> System
                            </label>
                            <label class="dropdown-checkbox">
                                <input type="checkbox" id="info-show-btc" checked> BTC Price
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="node-status-content">
                <!-- Connected Card -->
                <div class="status-card card-connected">
                    <div class="card-label">Connected</div>
                    <div class="card-value-large" id="stat-connected">-</div>
                </div>

                <!-- Networks Card -->
                <div class="status-card card-networks" id="card-networks">
                    <div class="networks-grid">
                        <div class="network-col" id="net-ipv4-wrap">
                            <span class="net-name net-ipv4">IPv4</span>
                            <div class="net-inout-row">
                                <span class="net-inout-item"><span class="net-inout-label">In</span><span class="net-inout-value" id="stat-ipv4-in">-</span></span>
                                <span class="net-inout-item"><span class="net-inout-label">Out</span><span class="net-inout-value" id="stat-ipv4-out">-</span></span>
                            </div>
                            <span class="net-score-label">Score</span>
                            <span class="net-score" id="info-score-ipv4">-</span>
                        </div>
                        <div class="network-col" id="net-ipv6-wrap">
                            <span class="net-name net-ipv6">IPv6</span>
                            <div class="net-inout-row">
                                <span class="net-inout-item"><span class="net-inout-label">In</span><span class="net-inout-value" id="stat-ipv6-in">-</span></span>
                                <span class="net-inout-item"><span class="net-inout-label">Out</span><span class="net-inout-value" id="stat-ipv6-out">-</span></span>
                            </div>
                            <span class="net-score-label">Score</span>
                            <span class="net-score" id="info-score-ipv6">-</span>
                        </div>
                        <div class="network-col" id="net-onion-wrap">
                            <span class="net-name net-onion">Tor</span>
                            <div class="net-inout-row">
                                <span class="net-inout-item"><span class="net-inout-label">In</span><span class="net-inout-value" id="stat-onion-in">-</span></span>
                                <span class="net-inout-item"><span class="net-inout-label">Out</span><span class="net-inout-value" id="stat-onion-out">-</span></span>
                            </div>
                            <span class="net-score-label">Score</span>
                            <span class="net-score">overlay</span>
                        </div>
                        <div class="network-col" id="net-i2p-wrap">
                            <span class="net-name net-i2p">I2P</span>
                            <div class="net-inout-row">
                                <span class="net-inout-item"><span class="net-inout-label">In</span><span class="net-inout-value" id="stat-i2p-in">-</span></span>
                                <span class="net-inout-item"><span class="net-inout-label">Out</span><span class="net-inout-value" id="stat-i2p-out">-</span></span>
                            </div>
                            <span class="net-score-label">Score</span>
                            <span class="net-score">overlay</span>
                        </div>
                        <div class="network-col" id="net-cjdns-wrap">
                            <span class="net-name net-cjdns">CJDNS</span>
                            <div class="net-inout-row">
                                <span class="net-inout-item"><span class="net-inout-label">In</span><span class="net-inout-value" id="stat-cjdns-in">-</span></span>
                                <span class="net-inout-item"><span class="net-inout-label">Out</span><span class="net-inout-value" id="stat-cjdns-out">-</span></span>
                            </div>
                            <span class="net-score-label">Score</span>
                            <span class="net-score">overlay</span>
                        </div>
                    </div>
                </div>

                <!-- Node Info Card -->
                <div class="status-card card-node" id="card-node">
                    <div class="card-label">Node Info</div>
                    <div class="node-info-grid">
                        <div class="node-info-row">
                            <span class="node-info-value" id="info-chain-size">-</span>
                        </div>
                        <div class="node-info-row">
                            <span class="node-info-value" id="info-node-type">-</span>
                        </div>
                        <div class="node-info-row">
                            <span class="node-info-value" id="info-node-indexed">-</span>
                        </div>
                        <div class="node-info-row">
                            <span class="node-info-value" id="info-sync-status">-</span>
                        </div>
                    </div>
                </div>

                <!-- System Card -->
                <div class="status-card card-system" id="card-system">
                    <div class="card-label">System</div>
                    <div class="system-stats">
                        <div class="system-row">
                            <span class="system-label">CPU</span>
                            <span class="system-value" id="info-cpu">-</span>
                            <span class="system-unit">%</span>
                        </div>
                        <div class="system-row">
                            <span class="system-label">MEM</span>
                            <span class="system-value" id="info-mem">-</span>
                            <span class="system-unit">%</span>
                        </div>
                    </div>
                </div>

                <!-- BTC Price Card -->
                <div class="status-card card-btc" id="card-btc">
                    <div class="card-label">BTC Price</div>
                    <div class="btc-price" id="info-btc-price">-</div>
                    <div class="btc-currency" id="info-btc-currency">USD</div>
                    <div class="btc-block">
                        <span class="btc-block-label">Last Block:</span>
                        <span class="btc-block-value" id="info-last-block">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Panel -->
        <div class="panel map-panel-full resizable-panel" id="map-panel">
            <div class="panel-header">
                <h2>Peer Map</h2>
                <span class="map-status" id="map-status">
                    <span class="status-dot status-ok" id="map-status-dot"></span>
                    <span id="map-status-text">Updated!</span>
                </span>
                <span class="map-legend">
                    <span class="legend-group" title="Public networks with geo location">
                        <span class="legend-label">Public:</span>
                        <span class="dot dot-ipv4" title="IPv4"></span>
                        <span class="dot dot-ipv6" title="IPv6"></span>
                    </span>
                    <span class="legend-group" title="Private networks clustered in Antarctica">
                        <span class="legend-label">Private (<a href="#" id="antarctica-toggle" class="antarctica-toggle">Hide</a> in Antarctica üêß):</span>
                        <span class="dot dot-onion" title="Tor/Onion"></span>
                        <span class="dot dot-i2p" title="I2P"></span>
                        <span class="dot dot-cjdns" title="CJDNS"></span>
                        <span class="dot dot-unavailable" title="Unavailable"></span>
                    </span>
                </span>
            </div>
            <div class="map-container" id="map"></div>
            <div class="resize-handle" data-panel="map-panel"></div>
        </div>

        <!-- Main Peer Table - 23 COLUMNS -->
        <div class="panel peer-panel resizable-panel" id="peer-panel">
            <div class="panel-header">
                <div class="peer-header-left">
                    <h2>Connected Peers:</h2>
                    <div class="network-counts" id="network-counts">
                        <span class="count-total network-filter-btn active" id="count-total" data-filter="all" title="Click to show all peers">all 0</span>
                        <span class="count-sep">|</span>
                        <span class="count-ipv4 network-filter-btn" id="count-ipv4" data-filter="ipv4" style="display: none;" title="Click to filter by IPv4">IPV4 0</span>
                        <span class="count-sep" id="sep-ipv4" style="display: none;">|</span>
                        <span class="count-ipv6 network-filter-btn" id="count-ipv6" data-filter="ipv6" style="display: none;" title="Click to filter by IPv6">IPV6 0</span>
                        <span class="count-sep" id="sep-ipv6" style="display: none;">|</span>
                        <span class="count-onion network-filter-btn" id="count-onion" data-filter="onion" style="display: none;" title="Click to filter by Tor/Onion">TOR 0</span>
                        <span class="count-sep" id="sep-onion" style="display: none;">|</span>
                        <span class="count-i2p network-filter-btn" id="count-i2p" data-filter="i2p" style="display: none;" title="Click to filter by I2P">I2P 0</span>
                        <span class="count-sep" id="sep-i2p" style="display: none;">|</span>
                        <span class="count-cjdns network-filter-btn" id="count-cjdns" data-filter="cjdns" style="display: none;" title="Click to filter by CJDNS">CJDNS 0</span>
                    </div>
                </div>
                <div class="panel-controls">
                    <span class="peer-count" id="peer-count">0 peers</span>
                    <button class="restore-defaults-btn" id="restore-defaults-btn" title="Restore default columns and order">Restore Defaults</button>
                    <button class="config-btn" id="column-config-btn" title="Configure visible columns">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="table-container" id="peer-table-container">
                <table class="peer-table" id="peer-table">
                    <thead>
                        <tr>
                            <!-- 1-6: getpeerinfo (instant) -->
                            <th data-sort="id" data-col="id" title="Peer ID assigned by Bitcoin Core">ID</th>
                            <th data-sort="network" data-col="network" title="Network type (ipv4, ipv6, onion, i2p, cjdns)">Net</th>
                            <th data-sort="ip" data-col="ip" title="IP address of the peer">IP</th>
                            <th data-sort="port" data-col="port" title="Port number">Port</th>
                            <th data-sort="direction" data-col="direction" title="Connection direction: IN=they connected to us, OUT=we connected to them">in/out</th>
                            <th data-sort="subver" data-col="subver" title="User agent / software version">Node ver/name</th>
                            <!-- 7-13: ip-api geo (loads second) -->
                            <th data-sort="city" data-col="city" title="City from geolocation">City</th>
                            <th data-sort="region" data-col="region" title="Region/state code">State/reg</th>
                            <th data-sort="regionName" data-col="regionName" title="Full region/state name">State/reg (full)</th>
                            <th data-sort="country" data-col="country" title="Country name">Country</th>
                            <th data-sort="countryCode" data-col="countryCode" title="2-letter country code">Ctry Code</th>
                            <th data-sort="continent" data-col="continent" title="Continent name">Continent</th>
                            <th data-sort="continentCode" data-col="continentCode" title="2-letter continent code">ContC</th>
                            <!-- 14-19: more getpeerinfo -->
                            <th data-sort="bytessent" data-col="bytessent" title="Total bytes sent to this peer">Sent</th>
                            <th data-sort="bytesrecv" data-col="bytesrecv" title="Total bytes received from this peer">Received</th>
                            <th data-sort="ping_ms" data-col="ping_ms" title="Current ping latency in milliseconds">Ping</th>
                            <th data-sort="conntime" data-col="conntime" title="How long connected">Duration</th>
                            <th data-sort="connection_type" data-col="connection_type" title="Connection type (outbound-full-relay, inbound, etc)">Type</th>
                            <th data-sort="services_abbrev" data-col="services_abbrev" title="Service flags: N=NETWORK, W=WITNESS, NL=NETWORK_LIMITED, P=P2P_V2, etc">Service</th>
                            <!-- 20-22: more ip-api -->
                            <th data-sort="lat" data-col="lat" title="Latitude coordinate">Lat</th>
                            <th data-sort="lon" data-col="lon" title="Longitude coordinate">Lon</th>
                            <th data-sort="isp" data-col="isp" title="Internet Service Provider">ISP</th>
                            <!-- 23: addrman status -->
                            <th data-sort="in_addrman" data-col="in_addrman" title="Is this peer's address in our address manager?">In Addrman?</th>
                        </tr>
                    </thead>
                    <tbody id="peer-tbody">
                        <tr class="loading-row">
                            <td colspan="23">Loading peers...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="resize-handle" data-panel="peer-panel"></div>
        </div>

        <!-- Column Config Modal -->
        <div class="modal" id="column-config-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Configure Columns</h3>
                    <button class="modal-close" id="modal-close">&times;</button>
                </div>
                <div class="modal-body" id="column-checkboxes">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Recent Connections/Disconnections Table -->
        <div class="panel changes-panel resizable-panel" id="changes-panel">
            <div class="panel-header">
                <h2>Recent Connections/Disconnections</h2>
                <div class="changes-window-control">
                    <span class="changes-window" id="changes-window-label">Last <span id="changes-window-value">20</span> seconds</span>
                    <button class="changes-config-btn" id="changes-config-btn" title="Configure time window">
                        <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                        </svg>
                    </button>
                    <div class="changes-config-dropdown" id="changes-config-dropdown">
                        <span class="dropdown-label">Show last:</span>
                        <button class="dropdown-option" data-seconds="10">10s</button>
                        <button class="dropdown-option" data-seconds="20">20s</button>
                        <button class="dropdown-option" data-seconds="30">30s</button>
                        <button class="dropdown-option" data-seconds="60">1m</button>
                        <button class="dropdown-option" data-seconds="120">2m</button>
                        <button class="dropdown-option" data-seconds="300">5m</button>
                    </div>
                </div>
            </div>
            <div class="table-container" id="changes-table-container">
                <table class="peer-table changes-table" id="changes-table">
                    <thead>
                        <tr>
                            <th data-col="time" title="Time of the event">Time</th>
                            <th data-col="event" title="Type of event: connected or disconnected">Event</th>
                            <th data-col="ip" title="IP address of the peer">IP</th>
                            <th data-col="network" title="Network type">Network</th>
                        </tr>
                    </thead>
                    <tbody id="changes-tbody">
                        <tr class="loading-row">
                            <td colspan="4">No recent changes</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="resize-handle" data-panel="changes-panel"></div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <span>MBCore Dashboard v2.3.4 | created by mbhillrn | Support (btc): bc1qy63057zemrskq0n02avq9egce4cpuuenm5ztf5</span>
            <span id="refresh-timer">Refreshing in 10s</span>
        </footer>
    </div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
