<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBCore Dashboard - Peer info, map, and tools for Bitcoin Core</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css?v={{ version }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- HEADER BAR                                                     -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <header class="header">
            <div class="header-left">
                <div class="header-logo-row">
                    <h1 class="logo-text" title="Peer info, map, and tools for Bitcoin Core"><span class="logo-m">M</span><span class="logo-btc">&#x20bf;</span><span class="logo-core">Core</span><span class="logo-light">Dashboard</span> <span class="version">v{{ version }}</span></h1>
                    <span class="header-author"><a href="https://github.com/mbhillrn/Bitcoin-Core-Peer-Map" target="_blank" rel="noopener" class="author-link" title="Visit mbhillrn MBCore repository: GitHub">Created by @mbhillrn</a></span>
                </div>
                <span class="header-btc-line">Support (btc): <span class="btc-copy" id="header-btc-copy" title="Click to copy BTC address to clipboard">bc1qy63057zemrskq0n02avq9egce4cpuuenm5ztf5</span></span>
            </div>
            <div class="header-right">
                <span class="header-time data-value" id="stat-localtime">--:--:--</span>
                <button class="header-btn header-btn-restore" id="restore-all-defaults-btn" title="Restore all settings to defaults">Restore Defaults</button>
                <button class="header-btn header-btn-settings" id="node-config-btn" title="Settings">
                    <svg width="15" height="15" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                        <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                    </svg>
                </button>
                <!-- Unified Settings Dropdown -->
                <div class="settings-dropdown" id="node-config-dropdown">
                    <div class="dropdown-section">
                        <span class="dropdown-section-title">Peer Update Frequency</span>
                        <div class="dropdown-row">
                            <input type="text" id="refresh-rate-input" value="10" class="refresh-input" title="Peer update frequency in seconds (min 5s)">
                            <span class="dropdown-unit">seconds</span>
                        </div>
                        <div class="dropdown-hint" id="refresh-rate-hint"></div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-section">
                        <span class="dropdown-section-title">Show/Hide Sections</span>
                        <label class="dropdown-checkbox">
                            <input type="checkbox" id="info-show-networks" checked> Network Stats
                        </label>
                        <label class="dropdown-checkbox">
                            <input type="checkbox" id="info-show-chain" checked> Node Info
                        </label>
                        <label class="dropdown-checkbox">
                            <input type="checkbox" id="info-show-system" checked> System
                        </label>
                        <label class="dropdown-checkbox">
                            <input type="checkbox" id="info-show-btc" checked> Bitcoin Price
                        </label>
                    </div>
                </div>
            </div>
        </header>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- MAIN CONTENT: Two-column layout (left + sidebar)              -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <div class="main-content">
            <!-- LEFT COLUMN: Node Status Bar + Map -->
            <div class="content-left">
                <!-- Node Status Bar -->
                <div class="panel node-status-bar" id="node-status-panel">
                    <div class="node-status-left">
                        <span class="status-indicator" id="status-indicator"></span>
                        <span class="status-text" id="connection-status">Connecting...</span>
                        <span class="status-count data-value" id="stat-connected" title="Total Connected Peers">-</span>
                        <div class="protocol-status" id="protocol-status">
                            <div class="protocol-line protocol-hoverable" title="Networks enabled in your Bitcoin Core configuration">
                                <span class="protocol-label">Enabled:</span>
                                <span class="protocol-list" id="protocols-enabled">-</span>
                            </div>
                            <div class="protocol-line protocol-hoverable" title="Networks not configured - add to bitcoin.conf to enable">
                                <span class="protocol-label">Not Configured:</span>
                                <span class="protocol-list" id="protocols-disabled">-</span>
                            </div>
                            <div class="protocol-hint" id="protocol-hint" style="display: none;">
                                <span>(Configure in Bitcoin Core to view)</span>
                            </div>
                        </div>
                    </div>
                    <div class="node-status-networks" id="card-networks">
                        <div class="network-col" id="net-ipv4-wrap">
                            <span class="net-name net-ipv4" title="Public IPv4 network">IPv4</span>
                            <span class="net-compact" title="In / Out">(<span class="data-value" id="stat-ipv4-in">-</span>/<span class="data-value" id="stat-ipv4-out">-</span>)</span>
                            <span class="net-total" id="stat-ipv4-total" style="display:none">(-)</span>
                            <span class="net-score data-value" id="info-score-ipv4" title="Bitcoin Core local network score">-</span>
                            <span class="net-score-label" id="score-label-ipv4" style="display:none">Score</span>
                        </div>
                        <div class="network-col" id="net-ipv6-wrap">
                            <span class="net-name net-ipv6" title="Public IPv6 network">IPv6</span>
                            <span class="net-compact" title="In / Out">(<span class="data-value" id="stat-ipv6-in">-</span>/<span class="data-value" id="stat-ipv6-out">-</span>)</span>
                            <span class="net-total" id="stat-ipv6-total" style="display:none">(-)</span>
                            <span class="net-score data-value" id="info-score-ipv6" title="Bitcoin Core local network score">-</span>
                            <span class="net-score-label" id="score-label-ipv6" style="display:none">Score</span>
                        </div>
                        <div class="network-col" id="net-onion-wrap">
                            <span class="net-name net-onion" title="Tor onion routing network">Tor</span>
                            <span class="net-compact" title="In / Out">(<span class="data-value" id="stat-onion-in">-</span>/<span class="data-value" id="stat-onion-out">-</span>)</span>
                            <span class="net-total" id="stat-onion-total" style="display:none">(-)</span>
                            <span class="net-score net-score-overlay" title="Network Score not available.&#10;Privacy overlay network using onion routing.">Overlay</span>
                        </div>
                        <div class="network-col" id="net-i2p-wrap">
                            <span class="net-name net-i2p" title="I2P anonymous network">I2P</span>
                            <span class="net-compact" title="In / Out">(<span class="data-value" id="stat-i2p-in">-</span>/<span class="data-value" id="stat-i2p-out">-</span>)</span>
                            <span class="net-total" id="stat-i2p-total" style="display:none">(-)</span>
                            <span class="net-score net-score-overlay" title="Network Score not available.&#10;Anonymous peer-to-peer overlay network.">Overlay</span>
                        </div>
                        <div class="network-col" id="net-cjdns-wrap">
                            <span class="net-name net-cjdns" title="CJDNS encrypted mesh network">CJDNS</span>
                            <span class="net-compact" title="In / Out">(<span class="data-value" id="stat-cjdns-in">-</span>/<span class="data-value" id="stat-cjdns-out">-</span>)</span>
                            <span class="net-total" id="stat-cjdns-total" style="display:none">(-)</span>
                            <span class="net-score net-score-overlay" title="Network Score not available.&#10;Encrypted IPv6 mesh overlay network.">Overlay</span>
                        </div>
                    </div>
                </div>

                <!-- Map Panel -->
                <div class="panel map-panel resizable-panel" id="map-panel">
                    <div class="panel-header map-header">
                        <span class="map-status" id="map-status">
                            <span class="map-title">Map</span>
                            <span class="map-countdown-label">Update in:</span>
                            <span class="map-countdown data-value" id="stat-countdown">10s</span>
                            <span class="map-status-sep">|</span>
                            <span class="status-dot status-ok" id="map-status-dot"></span>
                            <span id="map-status-text">Map Loaded!</span>
                        </span>
                        <div class="map-region-selector">
                            <select id="map-display-mode" title="Map display mode">
                                <option value="normal">Normal</option>
                                <option value="wrap-points">Wrap + Points</option>
                                <option value="wrap-only">Wrap Only</option>
                                <option value="stretched">Stretched</option>
                            </select>
                            <button class="map-fit-btn" id="map-fit-all-btn" title="Zoom to show all connected peers">Fit All</button>
                            <select id="map-region-select" title="Select map region">
                                <option value="world">World</option>
                                <option value="north-america">North America</option>
                                <option value="south-america">South America</option>
                                <option value="europe">Europe</option>
                                <option value="africa">Africa</option>
                                <option value="middle-east">Middle East</option>
                                <option value="asia">Asia</option>
                                <option value="oceania">Oceania</option>
                                <option value="antarctica">Antarctica (Private Networks)</option>
                            </select>
                        </div>
                        <span class="map-legend">
                            <span class="legend-group" title="Public networks with geo location">
                                <span class="legend-label">Public:</span>
                                <span class="dot dot-ipv4" title="IPv4"></span>
                                <span class="dot dot-ipv6" title="IPv6"></span>
                            </span>
                            <span class="legend-group" title="Private networks clustered near Antarctic research stations">
                                <span class="legend-label">Private (<a href="#" id="antarctica-toggle" class="antarctica-toggle" title="Toggle visibility of private network dots in Antarctica">Hide</a> <span class="penguin-icon" title="Private networks (Tor, I2P, CJDNS) are placed near Antarctic research stations since they have no real geolocation. Click Hide/Show to toggle.">&#x1F427;</span>):</span>
                                <span class="dot dot-onion" title="Tor/Onion"></span>
                                <span class="dot dot-i2p" title="I2P"></span>
                                <span class="dot dot-cjdns" title="CJDNS"></span>
                                <span class="dot dot-unavailable" title="Unavailable"></span>
                            </span>
                        </span>
                    </div>
                    <div class="map-container" id="map"></div>
                    <div class="resize-handle" data-panel="map-panel"></div>
                </div>
            </div>

            <!-- RIGHT SIDEBAR -->
            <div class="sidebar">
                <!-- Node Info Section -->
                <div class="sidebar-section" id="card-node">
                    <div class="sidebar-section-header" id="sidebar-node-header" title="Node information">
                        <span class="sidebar-section-title">Node Info</span>
                        <span class="sidebar-subver data-value" id="sidebar-node-subver" title="Bitcoin Core version string"></span>
                    </div>
                    <div class="sidebar-rows">
                        <div class="sidebar-row">
                            <span class="sidebar-label" title="Total Connected Peers">Peers</span>
                            <span class="sidebar-value data-value" id="sidebar-peers" title="Total Connected Peers">-</span>
                        </div>
                        <div class="sidebar-row">
                            <span class="sidebar-label" title="Total size of Bitcoin Core including database, chain state, and indexes">Size</span>
                            <span class="sidebar-value data-value" id="info-chain-size" title="Total size of Bitcoin Core including database, chain state, and indexes">-</span>
                        </div>
                        <div class="sidebar-row">
                            <span class="sidebar-label" title="Full vs Pruned Node">Type</span>
                            <span class="sidebar-value data-value" id="info-node-type" title="Full vs Pruned Node">-</span>
                        </div>
                        <div class="sidebar-row">
                            <span class="sidebar-label" title="Indexing Enabled?">Indexed</span>
                            <span class="sidebar-value data-value" id="info-node-indexed" title="Indexing Enabled?">-</span>
                        </div>
                        <div class="sidebar-row">
                            <span class="sidebar-label" title="IBD Status">Up to date</span>
                            <span class="sidebar-value data-value" id="info-sync-status" title="IBD Status">-</span>
                        </div>
                        <div class="sidebar-row">
                            <span class="sidebar-label sidebar-link" id="mempool-info-btn" title="Click for mempool info">Mempool</span>
                            <span class="sidebar-value data-value" id="sidebar-mempool">-</span>
                        </div>
                        <div class="sidebar-row">
                            <span class="sidebar-label sidebar-link" id="blockchain-info-btn" title="Click for blockchain info">Last Block</span>
                            <span class="sidebar-value data-value" id="info-last-block">-</span>
                        </div>
                    </div>
                </div>

                <!-- System Information Section -->
                <div class="sidebar-section" id="card-system">
                    <div class="sidebar-section-header" title="System and MBCore information">
                        <span class="sidebar-section-title">System Information</span>
                    </div>
                    <div class="sidebar-rows">
                        <div class="sidebar-row">
                            <span class="sidebar-label" id="sidebar-cpu-label" title="Host CPU utilization (all cores averaged)">CPU</span>
                            <span class="sidebar-value sidebar-value-hoverable" id="sidebar-cpu-value" title="Host CPU utilization (all cores averaged)">
                                <span class="data-value" id="info-cpu">-</span><span class="sidebar-unit">%</span>
                            </span>
                        </div>
                        <div class="sidebar-row">
                            <span class="sidebar-label" id="sidebar-mem-label" title="System memory usage">RAM</span>
                            <span class="sidebar-value sidebar-value-hoverable" id="sidebar-mem-value" title="System memory usage">
                                <span class="data-value" id="info-mem">-</span><span class="sidebar-unit">%</span>
                            </span>
                        </div>
                        <div class="sidebar-row">
                            <span class="sidebar-label sidebar-link" id="geodb-info-btn" title="Click for MBCore DB info and update">MBCore DB</span>
                            <span class="sidebar-value data-value" id="info-geodb-status">-</span>
                        </div>
                        <!-- Network Traffic Bars -->
                        <div class="sidebar-traffic" title="Real-time network throughput (all interfaces)">
                            <div class="net-traffic-row-inline">
                                <span class="net-traffic-dir-inline">IN</span>
                                <div class="net-traffic-bar-wrap-inline">
                                    <div class="net-traffic-bar net-traffic-bar-in" id="net-traffic-bar-in"></div>
                                </div>
                                <span class="net-traffic-rate-inline data-value" id="net-traffic-rate-in">-</span>
                            </div>
                            <div class="net-traffic-row-inline">
                                <span class="net-traffic-dir-inline">OUT</span>
                                <div class="net-traffic-bar-wrap-inline">
                                    <div class="net-traffic-bar net-traffic-bar-out" id="net-traffic-bar-out"></div>
                                </div>
                                <span class="net-traffic-rate-inline data-value" id="net-traffic-rate-out">-</span>
                            </div>
                        </div>
                    </div>
                    <!-- Geo DB Dropdown -->
                    <div class="geodb-dropdown" id="geodb-dropdown">
                        <div class="geodb-dropdown-title">Geo/IP Database</div>
                        <div class="geodb-dropdown-rows" id="geodb-dropdown-rows"></div>
                        <div class="geodb-dropdown-divider"></div>
                        <div class="geodb-dropdown-note">Check the server for any peer locations you don't already have. Your existing data will not be removed or modified.</div>
                        <button class="geodb-update-btn" id="geodb-update-btn">Update</button>
                        <div class="geodb-update-msg" id="geodb-update-msg"></div>
                    </div>
                </div>

                <!-- Bitcoin Price Section -->
                <div class="sidebar-section" id="card-btc">
                    <div class="sidebar-section-header" title="Change currency by clicking the currency code below">
                        <span class="sidebar-section-title">&#8383; Price</span>
                    </div>
                    <div class="sidebar-price">
                        <div class="sidebar-price-value data-value" id="info-btc-price">-</div>
                        <div class="sidebar-price-currency-row">
                            <span class="sidebar-price-currency sidebar-link" id="info-btc-currency" title="Click to change currency">USD</span>
                        </div>
                        <!-- Currency Dropdown -->
                        <div class="currency-dropdown" id="currency-dropdown">
                            <div class="dropdown-section">
                                <span class="dropdown-section-title">Currency</span>
                                <select id="info-currency-select" class="info-currency-select">
                                    <option value="USD">USD</option>
                                    <option value="EUR">EUR</option>
                                    <option value="GBP">GBP</option>
                                    <option value="JPY">JPY</option>
                                    <option value="CHF">CHF</option>
                                    <option value="CAD">CAD</option>
                                    <option value="AUD">AUD</option>
                                    <option value="CNY">CNY</option>
                                    <option value="HKD">HKD</option>
                                    <option value="SGD">SGD</option>
                                </select>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-section">
                                <span class="dropdown-section-title">Price Update Frequency</span>
                                <div class="dropdown-row">
                                    <input type="text" id="price-rate-input" value="10" class="refresh-input" title="Price update frequency in seconds (min 5s)">
                                    <span class="dropdown-unit">seconds</span>
                                </div>
                                <div class="dropdown-hint" id="price-rate-hint"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Updates Mini-Widget -->
                <div class="sidebar-section sidebar-section-updates">
                    <div class="sidebar-section-header">
                        <span class="sidebar-section-title">Recent Updates</span>
                        <div class="sidebar-updates-controls">
                            <button class="sidebar-small-btn" id="changes-config-btn" title="Configure time window">
                                <svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                                    <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                                </svg>
                            </button>
                            <div class="changes-config-dropdown" id="changes-config-dropdown">
                                <span class="dropdown-label">Show last:</span>
                                <button class="dropdown-option" data-seconds="10">10s</button>
                                <button class="dropdown-option" data-seconds="20">20s</button>
                                <button class="dropdown-option" data-seconds="30">30s</button>
                                <button class="dropdown-option" data-seconds="60">1m</button>
                                <button class="dropdown-option" data-seconds="120">2m</button>
                                <button class="dropdown-option" data-seconds="300">5m</button>
                            </div>
                            <button class="sidebar-small-btn" id="toggle-changes-panel-btn" title="Show Recent Updates Panel under the Peer List panel">
                                <svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M2 2.5A.5.5 0 0 1 2.5 2h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 2.5zm0 4A.5.5 0 0 1 2.5 6h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 6.5zm0 4A.5.5 0 0 1 2.5 10h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0 4A.5.5 0 0 1 2.5 14h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="sidebar-updates-window">
                        <span class="changes-window" id="changes-window-label">Last <span class="data-value" id="changes-window-value">20</span>s</span>
                    </div>
                    <div class="sidebar-updates-list" id="sidebar-updates-list">
                        <div class="sidebar-updates-empty">No recent changes</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- PEER TABLE (full width)                                        -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <div class="panel peer-panel resizable-panel" id="peer-panel">
            <div class="panel-header">
                <div class="peer-header-left">
                    <h2>Peers</h2>
                    <div class="network-counts" id="network-counts">
                        <span class="count-total network-filter-btn active" id="count-total" data-filter="all" title="Click to show all peers">all 0</span>
                        <span class="count-sep">|</span>
                        <span class="count-ipv4 network-filter-btn" id="count-ipv4" data-filter="ipv4" style="display: none;" title="Click to filter by IPv4">IPV4 0</span>
                        <span class="count-sep" id="sep-ipv4" style="display: none;">|</span>
                        <span class="count-ipv6 network-filter-btn" id="count-ipv6" data-filter="ipv6" style="display: none;" title="Click to filter by IPv6">IPV6 0</span>
                        <span class="count-sep" id="sep-ipv6" style="display: none;">|</span>
                        <span class="count-onion network-filter-btn" id="count-onion" data-filter="onion" style="display: none;" title="Click to filter by Tor/Onion">TOR 0</span>
                        <span class="count-sep" id="sep-onion" style="display: none;">|</span>
                        <span class="count-i2p network-filter-btn" id="count-i2p" data-filter="i2p" style="display: none;" title="Click to filter by I2P">I2P 0</span>
                        <span class="count-sep" id="sep-i2p" style="display: none;">|</span>
                        <span class="count-cjdns network-filter-btn" id="count-cjdns" data-filter="cjdns" style="display: none;" title="Click to filter by CJDNS">CJDNS 0</span>
                    </div>
                </div>
                <div class="panel-controls">
                    <button class="peer-action-btn peer-action-btn-connect" id="connect-peer-btn" title="Connect to a peer">Connect Peer</button>
                    <button class="peer-action-btn peer-action-btn-disconnect" id="disconnect-peer-btn" title="Disconnect or ban a peer">Disconnect Peer</button>
                    <!-- Disconnect Peer Dropdown -->
                    <div class="disconnect-dropdown" id="disconnect-dropdown">
                        <div class="disconnect-warning">
                            <span class="warning-icon">&#9888;</span>
                            <span class="warning-text">ADVANCED - USE WITH CAUTION</span>
                        </div>
                        <div class="disconnect-subtext">Disconnecting/banning peers is not recommended for normal operation.</div>
                        <div class="disconnect-divider"></div>
                        <div class="disconnect-row">
                            <label class="disconnect-label">Peer ID:</label>
                            <input type="text" id="disconnect-peer-id" class="disconnect-input" placeholder="Enter ID">
                            <button class="disconnect-confirm-btn" id="disconnect-confirm-btn">Disconnect</button>
                        </div>
                        <div class="disconnect-checkbox-row">
                            <label class="disconnect-checkbox">
                                <input type="checkbox" id="disconnect-ban-checkbox">
                                <span>Ban IP for 24 hours</span>
                            </label>
                        </div>
                        <div class="disconnect-ban-note">Ban works for IPv4/IPv6 IPs only.<br>Tor/I2P/CJDNS don't have bannable IP identities in Core.</div>
                        <div class="disconnect-divider"></div>
                        <div class="disconnect-actions">
                            <button class="disconnect-action-btn" id="list-bans-btn">List Banned IPs</button>
                            <button class="disconnect-action-btn disconnect-action-btn-danger" id="clear-bans-btn">Clear All Bans</button>
                        </div>
                    </div>
                    <!-- Column config button (columns icon, not gear) -->
                    <button class="config-btn" id="column-config-btn" title="Configure visible columns">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <rect x="1" y="1" width="3" height="14" rx="0.5" opacity="0.7"/>
                            <rect x="6.5" y="1" width="3" height="14" rx="0.5" opacity="0.5"/>
                            <rect x="12" y="1" width="3" height="14" rx="0.5" opacity="0.7"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="table-container" id="peer-table-container">
                <table class="peer-table" id="peer-table">
                    <thead>
                        <tr>
                            <th data-sort="id" data-col="id" title="Peer ID assigned by Bitcoin Core">ID</th>
                            <th data-sort="network" data-col="network" title="Network type (ipv4, ipv6, onion, i2p, cjdns)">Net</th>
                            <th data-sort="ip" data-col="ip" title="IP address of the peer">IP</th>
                            <th data-sort="port" data-col="port" title="Port number">Port</th>
                            <th data-sort="direction" data-col="direction" title="Connection direction: IN=they connected to us, OUT=we connected to them">in/out</th>
                            <th data-sort="subver" data-col="subver" title="User agent / software version">Node ver/name</th>
                            <th data-sort="city" data-col="city" title="City from geolocation">City</th>
                            <th data-sort="region" data-col="region" title="Region/state code">State/reg</th>
                            <th data-sort="regionName" data-col="regionName" title="Full region/state name">State/reg (full)</th>
                            <th data-sort="country" data-col="country" title="Country name">Country</th>
                            <th data-sort="countryCode" data-col="countryCode" title="2-letter country code">Ctry Code</th>
                            <th data-sort="continent" data-col="continent" title="Continent name">Continent</th>
                            <th data-sort="continentCode" data-col="continentCode" title="2-letter continent code">ContC</th>
                            <th data-sort="bytessent" data-col="bytessent" title="Total bytes sent to this peer">Sent</th>
                            <th data-sort="bytesrecv" data-col="bytesrecv" title="Total bytes received from this peer">Received</th>
                            <th data-sort="ping_ms" data-col="ping_ms" title="Current ping latency in milliseconds">Ping</th>
                            <th data-sort="conntime" data-col="conntime" title="How long connected">Duration</th>
                            <th data-sort="connection_type" data-col="connection_type" title="Connection type (outbound-full-relay, inbound, etc)">Type</th>
                            <th data-sort="services_abbrev" data-col="services_abbrev" title="Service flags: N=NETWORK, W=WITNESS, NL=NETWORK_LIMITED, P=P2P_V2, etc">Service</th>
                            <th data-sort="lat" data-col="lat" title="Latitude coordinate">Lat</th>
                            <th data-sort="lon" data-col="lon" title="Longitude coordinate">Lon</th>
                            <th data-sort="isp" data-col="isp" title="Internet Service Provider">ISP</th>
                            <th data-sort="in_addrman" data-col="in_addrman" title="Is this peer's address in our address manager?">In Addrman?</th>
                        </tr>
                    </thead>
                    <tbody id="peer-tbody">
                        <tr class="loading-row">
                            <td colspan="23">Loading peers...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="resize-handle" data-panel="peer-panel"></div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- MODALS (unchanged logic, preserved IDs)                        -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- Column Config Modal -->
        <div class="modal" id="column-config-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Configure Columns</h3>
                    <button class="modal-close" id="modal-close">&times;</button>
                </div>
                <div class="modal-body" id="column-checkboxes"></div>
                <div class="modal-footer">
                    <div class="modal-footer-row">
                        <span class="modal-footer-label">Visible rows:</span>
                        <select id="peer-row-limit" title="Number of peer rows to show before scrolling">
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="15" selected>15</option>
                            <option value="20">20</option>
                            <option value="25">25</option>
                            <option value="30">30</option>
                            <option value="35">35</option>
                            <option value="40">40</option>
                            <option value="45">45</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    <button class="restore-defaults-btn" id="restore-defaults-btn" title="Restore default columns and order">Restore Column Defaults</button>
                </div>
            </div>
        </div>

        <!-- Blockchain Info Modal -->
        <div class="modal" id="blockchain-modal">
            <div class="modal-content modal-content-wide">
                <div class="modal-header">
                    <h3>Blockchain Information</h3>
                    <button class="modal-close" id="blockchain-modal-close">&times;</button>
                </div>
                <div class="modal-body modal-body-single" id="blockchain-modal-body">
                    <div class="mempool-loading">Loading blockchain info...</div>
                </div>
            </div>
        </div>

        <!-- Mempool Info Modal -->
        <div class="modal" id="mempool-modal">
            <div class="modal-content modal-content-wide">
                <div class="modal-header">
                    <h3>Mempool Information</h3>
                    <button class="modal-close" id="mempool-modal-close">&times;</button>
                </div>
                <div class="modal-body modal-body-single" id="mempool-modal-body">
                    <div class="mempool-loading">Loading mempool info...</div>
                </div>
            </div>
        </div>

        <!-- Connect Peer Modal -->
        <div class="modal" id="connect-peer-modal">
            <div class="modal-content modal-content-wide">
                <div class="modal-header">
                    <h3>Connect to Peer</h3>
                    <button class="modal-close" id="connect-modal-close">&times;</button>
                </div>
                <div class="modal-body modal-body-single">
                    <div class="connect-instructions">
                        <p class="connect-main-text">Enter the peer's listening address. If you omit the port, we'll use <strong>8333</strong> for IPv4/IPv6/Tor.</p>
                        <p class="connect-note">Note: This may differ from what appears in the Connected Peers table.</p>
                    </div>
                    <div class="connect-examples">
                        <div class="connect-examples-title">Examples (port optional for most):</div>
                        <div class="connect-example"><span class="example-type">IPv4:</span> 192.168.1.10 <span class="example-port">(w/port: 192.168.1.10:8333)</span></div>
                        <div class="connect-example"><span class="example-type">IPv6:</span> [2001:db8::1] <span class="example-port">(w/port: [2001:db8::1]:8333)</span></div>
                        <div class="connect-example"><span class="example-type">Tor:</span> abc...xyz.onion</div>
                        <div class="connect-example"><span class="example-type">CJDNS:</span> [fc00::1]</div>
                        <div class="connect-example-divider"></div>
                        <div class="connect-example connect-i2p-inline"><span class="example-type example-type-i2p">I2P:</span> abc...xyz.b32.i2p:0 <span class="i2p-required">(port :0 required)</span></div>
                    </div>
                    <div class="connect-input-row">
                        <label class="connect-label">Enter Address:</label>
                        <input type="text" id="connect-peer-address" class="connect-input" placeholder="Enter address">
                    </div>
                    <div class="connect-actions">
                        <button class="connect-btn" id="connect-confirm-btn">Connect</button>
                    </div>
                    <div class="connect-result" id="connect-result"></div>
                    <div class="connect-divider"></div>
                    <div class="connect-permanent">
                        <div class="connect-permanent-title">To add permanently:</div>
                        <div class="connect-cmd-wrapper">
                            <div class="connect-permanent-cmd" id="connect-permanent-cmd">Loading CLI info...</div>
                            <button class="copy-btn" id="copy-cmd-btn" title="Copy to clipboard">
                                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
                                    <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="connect-permanent-note">Or add <code id="connect-conf-note">addnode=&lt;address&gt;</code> to your bitcoin.conf</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bans List Modal -->
        <div class="modal" id="bans-modal">
            <div class="modal-content modal-content-wide">
                <div class="modal-header">
                    <h3>Banned IPs</h3>
                    <button class="modal-close" id="bans-modal-close">&times;</button>
                </div>
                <div class="modal-body modal-body-single" id="bans-modal-body">
                    <div class="bans-loading">Loading banned IPs...</div>
                </div>
            </div>
        </div>

        <!-- Recent Changes Bottom Panel (hidden by default) -->
        <div class="panel changes-panel resizable-panel" id="changes-panel" style="display: none;">
            <div class="panel-header">
                <h2>Recent Connections/Disconnections</h2>
            </div>
            <div class="table-container" id="changes-table-container">
                <table class="peer-table changes-table" id="changes-table">
                    <thead>
                        <tr>
                            <th data-col="time" title="Time of the event">Time</th>
                            <th data-col="event" title="Type of event: connected or disconnected">Event</th>
                            <th data-col="ip" title="IP address of the peer">IP</th>
                            <th data-col="network" title="Network type">Network</th>
                        </tr>
                    </thead>
                    <tbody id="changes-tbody">
                        <tr class="loading-row">
                            <td colspan="4">No recent changes</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="resize-handle" data-panel="changes-panel"></div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <span>MBCore Dashboard v{{ version }}</span>
            <span id="refresh-timer">Refreshing in 10s</span>
        </footer>
    </div>

    <script src="/static/js/dashboard.js?v={{ version }}"></script>
</body>
</html>
